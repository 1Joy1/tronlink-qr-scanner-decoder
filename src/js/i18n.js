// –°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ (i18n) –¥–ª—è TRON LINK QR Scanner
const translations = {
  ru: {
    // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    title: "–°–∫–∞–Ω–µ—Ä QR-–∫–æ–¥–æ–≤ TRON LINK",
    scanButton: "–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å",
    stopButton: "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å",
    decodeButton: "–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é",
    
    // QR Scanner
    qrScanner: {
      noLibrary: "‚ö†Ô∏è –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ jsQR!",
      scanningImpossible: "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é:",
      scanningStopped: "‚ö†Ô∏è –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!",
      qrRecognized: "‚úÖ QR-–∫–æ–¥ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω!",
      content: "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:",
      cameraError: "–û—à–∏–±–∫–∞"
    },
    
    // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
    decode: {
      result: "üìã –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:",
      type: "–¢–∏–ø",
      typeNotDefined: "–ù–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω!",
      
      // –ü–æ–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
      sender: "–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:",
      recipient: "–ü–æ–ª—É—á–∞—Ç–µ–ª—å:",
      amount: "–°—É–º–º–∞:",
      contractAddress: "–ê–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞:",
      allowTo: "–ö–æ–º—É —Ä–∞–∑—Ä–µ—à–∞–µ–º:",
      allowFrom: "–û—Ç –∫–æ–≥–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º:",
      
      // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
      created: "–°–æ–∑–¥–∞–Ω:",
      expires: "–ò—Å—Ç–µ–∫–∞–µ—Ç:",
      
      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
      showHexData: "üìÑ –ü–æ–∫–∞–∑–∞—Ç—å hex –¥–∞–Ω–Ω—ã–µ",
      showFullData: "üìÑ –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
      hideButton: "–°–∫—Ä—ã—Ç—å",
      showHexButton: "‚¨áHEX‚¨á",
      
      // –¢–æ–∫–µ–Ω—ã –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
      unknownToken: "&lt;–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω&gt;",
      unknownContract: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç",
      unlimited: "&lt;–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π&gt;"
    },
    
    // –û–ø–∏—Å–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
    contractFunctions: {
      "transfer(address,uint256)": "–ü–µ—Ä–µ–≤–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤",
      "approve(address,uint256)": "–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∞–¥—Ä–µ—Å—É —Ä–∞—Å–ø–æ—Ä—è–∂–∞—Ç—å—Å—è —Ç–æ–∫–µ–Ω–∞–º–∏",
      "transferFrom(address,address,uint256)": "–ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç—Ä–µ—Ç—å–µ–π —Å—Ç–æ—Ä–æ–Ω–µ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω—ã –æ—Ç –æ–¥–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –∫ –¥—Ä—É–≥–æ–º—É, –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π –∞–¥—Ä–µ—Å –∑–∞—Ä–∞–Ω–µ–µ —Å–¥–µ–ª–∞–ª approve.",
      "mint(address,uint256)": "–°–æ–∑–¥–∞—Ç—å (–≤—ã–ø—É—Å—Ç–∏—Ç—å) –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã.",
      "burn(uint256)": "–£–Ω–∏—á—Ç–æ–∂–∏—Ç—å —á–∞—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤, —É–º–µ–Ω—å—à–∏–≤ –æ–±—â–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.",
      "increaseAllowance(address,uint256)": "–£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ (allowance) –¥–ª—è —Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –∞–¥—Ä–µ—Å–∞ (—Å–ø–µ–Ω–¥–µ—Ä–∞)",
      "transferOwnership(address)": "–ü–µ—Ä–µ–¥–∞—Ç—å –≤–ª–∞–¥–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º –¥—Ä—É–≥–æ–º—É –∞–¥—Ä–µ—Å—É. –ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ç–∞—Ä—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü —Ç–µ—Ä—è–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–∑—ã–≤–∞—Ç—å mint)."
    },
    
    // –û—à–∏–±–∫–∏
    errors: {
      notJson: "‚ùå –°—Ç—Ä–æ–∫–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è JSON",
      noHexList: "‚ùå –û—à–∏–±–∫–∞: hexList –ø—É—Å—Ç –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç",
      invalidFormat1: "‚ùå –°—Ç—Ä–æ–∫–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç 0a1541 –∏ –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0a",
      invalidFormat2: "‚ùå –°—Ç—Ä–æ–∫–∞ –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0a**5a**22",
      decodingError: "‚ùå –û—à–∏–±–∫–∞"
    }
  },
  
  en: {
    // Main interface elements
    title: "TRON LINK QR Scanner",
    scanButton: "Scan",
    stopButton: "Stop",
    decodeButton: "Decode Transaction",
    
    // QR Scanner
    qrScanner: {
      noLibrary: "‚ö†Ô∏è jsQR library not loaded!",
      scanningImpossible: "Scanning is impossible, enter data manually:",
      scanningStopped: "‚ö†Ô∏è Scanning stopped!",
      qrRecognized: "‚úÖ QR code recognized!",
      content: "Content:",
      cameraError: "Error"
    },
    
    // Decoding results
    decode: {
      result: "üìã Decoding Result:",
      type: "Type",
      typeNotDefined: "Not defined!",
      
      // Transaction fields
      sender: "From:",
      recipient: "To:",
      amount: "Amount:",
      contractAddress: "Contract Address:",
      allowTo: "Allow To:",
      allowFrom: "Allow From:",
      
      // Timestamps
      created: "Created:",
      expires: "Expires:",
      
      // Additional information
      showHexData: "üìÑ Show hex data",
      showFullData: "üìÑ Show full data",
      hideButton: "‚¨ÜHide‚¨Ü",
      showHexButton: "‚¨áHEX‚¨á",
      
      // Tokens and contracts
      unknownToken: "&lt;unknown token&gt;",
      unknownContract: "Unknown contract",
      unlimited: "&lt;unlimited&gt;"
    },
    
    // Smart contract function descriptions
    contractFunctions: {
      "transfer(address,uint256)": "Transfer tokens",
      "approve(address,uint256)": "Approve address to spend tokens",
      "transferFrom(address,address,uint256)": "Allows a third party to transfer tokens from one address to another, provided the first address has previously approved it.",
      "mint(address,uint256)": "Create (mint) new tokens.",
      "burn(uint256)": "Burn tokens, reducing the total supply.",
      "increaseAllowance(address,uint256)": "Increase allowance for a third-party address (spender)",
      "transferOwnership(address)": "Transfer contract ownership to another address. After calling this function, the old owner loses privileges (e.g., the ability to call mint)."
    },
    
    // Errors
    errors: {
      notJson: "‚ùå String is not JSON",
      noHexList: "‚ùå Error: hexList is empty or missing",
      invalidFormat1: "‚ùå String doesn't contain 0a1541 and doesn't start with 0a",
      invalidFormat2: "‚ùå String doesn't start with 0a**5a**22",
      decodingError: "‚ùå Error"
    }
  }
};

/**
 * –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞
 * @param {string} key - –ö–ª—é—á –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'section.subsection.key'
 * @returns {string} - –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ –∫–ª—é—á, –µ—Å–ª–∏ –ø–µ—Ä–µ–≤–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
 */
function t(key) {
  const keys = key.split('.');
  let value = translations[getCurrentLanguage()];
  
  for (const k of keys) {
    value = value?.[k];
    if (value === undefined) break;
  }
  
  return value !== undefined ? value : key;
}

/**
 * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞
 */
function updatePageLanguage() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const translation = t(key);

    element.textContent = translation;
  });
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫
 * @returns {string} - –ö–æ–¥ —Ç–µ–∫—É—â–µ–≥–æ —è–∑—ã–∫–∞
 */
function getCurrentLanguage() {
  return document.documentElement.lang;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
// –¢–µ–∫—É—â–∏–π —è–∑—ã–∫ 'en' | 'ru' –±–µ—Ä–µ–º –∏–∑ document.documentElement.lang
document.addEventListener('DOMContentLoaded', (event) => {
  const langSelect = document.getElementById('lang-select');  
    if (langSelect) {
      // 1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–∞ —Ä–∞–≤–Ω—ã–º –∞—Ç—Ä–∏–±—É—Ç—É lang —Ç–µ–≥–∞ <html>
      langSelect.value = document.documentElement.lang;

      // 2. –í—Ä—É—á–Ω—É—é –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ 'change'
      const event = new Event('change', { bubbles: true });
      langSelect.dispatchEvent(event);
    }
});

document.body.addEventListener('change', (event) => {
  if (event.target.id === 'lang-select') {
    document.documentElement.lang = event.target.value;
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    updatePageLanguage();
  }
});

